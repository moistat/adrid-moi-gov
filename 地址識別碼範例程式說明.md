API介接說明
---

API認證機制
---

使用金鑰進行身分驗證，將金鑰帶入即可存取OpenAPI服務。

欲取得金鑰，需先註冊為系統會員，並於會員專區申請API金鑰，
經後台管理員審核通過後，可於 **```[會員專區]-[會員資料管理]```** 查看API金鑰相關內容。

![image](/src/main/resources/static/img/1.png)

API金鑰
---
包含金鑰(Access Token)與刷新金鑰(Refresh Token)


##### 金鑰(Access Token)
 * 可用於所有的OpenAPI進行身分驗證。
 * 默認申請後第一次使用的IP位置，做為日後使用者的驗證IP。
 * 金鑰的使用期限為1日。

##### 刷新金鑰(Refresh Token)
* 用於更新金鑰的使用期限。
* 刷新金鑰的使用期限為2日。
* 當系統判定金鑰過期時，即要求使用者帶入刷新金鑰，以更新金鑰的使用期限。
* 若金鑰與刷新金鑰皆過期，使用者需回到 **```[會員專區]-[會員資料管理]```**，
 重新整理頁面後，即得一組新的API金鑰。

OpenAPI綁定金鑰
--

1. 進入OpenAPI Swagger頁面 

於 **```[API服務]-[前往地址識別碼API線上說明文件]```**，開啟OpenAPI介接之Swagger畫面。

![image](/src/main/resources/static/img/2.png)

2. 於Swagger頁面綁定API金鑰


點選右上方的 **```[Authorization]```**</span>。

![image](/src/main/resources/static/img/33.png)

待畫面出現金鑰的認證框後，於Value欄位貼上金鑰。

![image](/src/main/resources/static/img/3.png)

```
注意：請確實按下下方[Authorization]按鈕，才能正確綁定金鑰，以利系統進行身分驗證。
每次進入只需綁定1次。若有重新整理或重新開啟務必再次綁定。
```



OpenAPI服務
---
網址: https:/adrid.moi.gov.tw/iisi/swagger-ui/index.html#

OpenAPI 共提供5項服務項目。

下圖依序分別為

* [地址修正](#revise-address)
* [更新金鑰效期](#refresh-token)
* [地址識別碼異動軌跡查詢](#single-track)
* [地址標準寫法查詢](#standard-address)
* [地址識別碼資訊查詢](#single-query)

  ![image](/src/main/resources/static/img/4.png)
  
## <div id="revise-address">地址修正</div>
**由【指定地址】取得【正確地址】資訊**
* 使用說明

1. 點擊右側 **```[下拉圖示]```**。

  ![image](/src/main/resources/static/img/5.png)
  
2. 點擊右側 **```[try it out]```** 按鈕。

  ![image](/src/main/resources/static/img/6.png)
  
3. 待頁面解鎖下方的輸入框。

  ![image](/src/main/resources/static/img/7.png)
  
4. 於輸入框輸入地址後，按下下方 **```[Execute]```**


 ```特別注意地址前後無須加上""或''```

  ![image](/src/main/resources/static/img/8.png)
  
 5. 執行完畢後下拉，會看見 **```[sever response]```** 之小標，下方黑框內容即為本次查詢結果。

  ![image](/src/main/resources/static/img/9.png)

* 請求參數說明: 

|英文|中文
| ------- | ----------------------
**originalAddressStr**|**來源地址**

* 響應內容說明

|英文|中文
| ------- | ----------------------
**msg** | **地址驗證結果**
**fullAddress**|**正確地址**
**origrinalAddress**|**來源地址**

--
## <div id="single-track">地址識別碼異動軌跡查詢</div>
**由【指定地址識別碼】取得【異動軌跡】資訊**

* 使用說明
 
參照單筆地址查詢，完成步驟(1)-(3)。

4. 於輸入框輸入**地址識別碼**，按下下方 **```[Execute]```**

![image](/src/main/resources/static/img/10.png)

```
特別注意地址前後無須加上""或''。
```
5. 執行完畢後下拉，會看見 **```[sever response]```** 之小標，下方黑框內容即為本次查詢結果。

![image](/src/main/resources/static/img/11.png)
 
* 請求參數說明

|英文|中文
| ------- | ----------------------
**addressId**|**地址識別碼**

* 響應內容說明

|英文|中文
| ------- | ----------------------
**text** | **識別碼驗證結果**
**addressId** | **地址編碼**
**hisAdr** | **歷史地址**
**wgsX** | **座標x**
**wgsY** | **座標y**
**updateType** | **戶政更新狀態**
**updateDt** | **戶政更新日期**
**status** | 
**historySeq** | 
**adrVersion** | 
**updateCode** | 


 

## <div id="standard-address">地址標準寫法查詢</div>


**由【指定地址】取得【該地址之標準寫法】**

* 使用說明

參照地址修正，完成步驟(1)-(3)。

 4. 於輸入框輸入地址後，按下下方 **```[Execute]```**

```
特別注意地址前後無須加上""或''。
```

  ![image](/src/main/resources/static/img/12.png)

  
 5. 執行完畢後下拉，會看見 **```[sever response]```** 之小標，下方黑框內容即為本次查詢結果。

  ![image](/src/main/resources/static/img/標準地址.png)

  
* 請求參數說明

|英文|中文
| ------- | ----------------------
**address**|**來源地址**

* 響應內容說明

|英文|中文
| ------- | ----------------------
**zipcode**|**郵遞區號**
**county**|**縣市**
**countyCd**|**縣市代碼**
**town**|**鄉鎮市區**
**townCd**|**鄉鎮市區代碼**
**village**|**村里**
**villageCd**|**村里代碼**
**neighbo**|**鄰**
**neighborCd**|**鄰代碼**
**road**|**路名**
**specialArea**|**特殊地名**
**area**|**地名**
**roadAreaSn**|**路地名代碼**
**lane**|**巷**
**laneCd**|**巷代碼**
**alley**|**弄**
**subAlley**|**衖衕橫**
**alleyIdSn**|**弄代碼**
**numFlr**|**號樓之**
**numFlr1Id**|**號樓之代碼**
**numFlr2**|**號樓之**
**numFlr2Id**|**號樓之代碼**
**numFlr3**|**號樓之**
**numFlr3Id**|**號樓之代碼**
**numFlr4**|**號樓之**
**numFlr4Id**|**號樓之代碼**
**numFlr5**|**號樓之**
**numFlr5Id**|**號樓之代碼**
**numFlrId**|**numFlr1~5 號樓之代碼組合**
**numFlrPos**|**樓層代碼**
**continuousNum**|**連號 (ex:45一號)**
**basementStr**|**一般樓層(0)、地下(1)、頂樓(2)**
**room**|**室**
**roomIdSn**|**室代碼**
**seq**|**seq**
**addrRemains**|**待補**
**originalAddress**|**使用者輸入地址**
**cleanAddress**|**排除關鍵字之使用者輸入地址**
**mappingId**|**地址片段代碼組合成56碼**
**segmentExistNumber**|**要件清單代號**
**segNumMap**|**要件清單**
**mappingIdMap**|**所有可能的mappingId**
**joinStep**|**地址比對代碼**
**seqSet**|**所有可能的seq**
**numTypeCd**|**地址是否含臨(96)、建(97)、特(98)、附(99)，無(95)**
**hasRoadArea**|**地址是否含路地名**
**remark**|**待補**
**jb2NumFlrId**|**地址排列JB2號樓之代碼(待確認顯示欄位後刪除)**
**jb3NumFlrId**|**地址排列JB3號樓之代碼(待確認顯示欄位後刪除)**
**jb4NumFlrId**|**地址排列JB4號樓之代碼(待確認顯示欄位後刪除)**
**jb5NumFlrId**|**地址排列JB5號樓之代碼(待確認顯示欄位後刪除)**
**jc4NumFlrId**|**地址排列JC4號樓之代碼(待確認顯示欄位後刪除)**
**jb2NumFlrPos**|**地址排列JB2樓層代碼(待確認顯示欄位後刪除)**
**jb3NumFlrPos**|**地址排列JB3樓層代碼(待確認顯示欄位後刪除)**
**jb4NumFlrPos**|**地址排列JB4樓層代碼(待確認顯示欄位後刪除)**
**jb5NumFlrPos**|**地址排列JB5樓層代碼(待確認顯示欄位後刪除)**
**jc4NumFlrPos**|**地址排列JC4樓層代碼(待確認顯示欄位後刪除)**
**parseSuccessed**|**是否成功切割**


## <div id="single-query">地址識別碼資訊查詢<div>

**由【指定地址】取得【地址識別碼相關資訊】**

* 使用說明

參照單筆地址查詢，完成步驟(1)-(3)。

 4. 於輸入框輸入【指定地址】後，按下下方 **```[Execute]```**
 
 ```
特別注意地址前後無須加上""或''。

地址後方可加入指定縣市、鄉鎮，以半形逗號區隔組合而成，或只輸地址。
  
 ex：台南市東區衛國里007鄰衛國街１１４巷９弄１０號B六樓之５,臺南市,東區
  
 ex：台南市東區衛國里007鄰衛國街１１４巷９弄１０號B六樓之５
  ```
  
![image](/src/main/resources/static/img/14.png)

5. 執行完畢後下拉，會看見 **```[sever response]```** 之小標，下方黑框內容即為本次查詢結果。

![image](/src/main/resources/static/img/15.png)

* 請求參數說明

|英文|中文
| ------- | ----------------------
**singleQueryStr**|**來源地址**

* 響應內容說明

|英文|中文
| ------- | ----------------------
**text**|**查詢結果**
**seq**|**seq**
**addressId**|**地址編碼**
**fullAddress**|**完整地址**
**validity**|**地址有效性**
**county**|**縣市**
**countyCd**|**縣市代碼**
**town**|**鄉鎮市區**
**townCd**|**鄉鎮市區代碼**
**postCode**|**郵遞區號**
**postCodeDt**|**郵遞區號更新日期**
**tcRoad**|**交通道路名稱**
**roadId**|**交通道路代碼**
**roadIdDt**|**道路代碼更新日期**
**x**|**TWD97 座標X**
**y**|**TWD97 座標Y**
**wgsX**|**WGS84 座標X**
**wgsY**|**WGS84 座標Y**
**geohash**|**網格編碼**
**xyYear**|**待刪除**
**adrVersion**|**母體版本**
**etldt**|**待刪除**
**joinStep**|**比對代碼**
**numFlrId**|**待刪除**
**numFlrPos**|**待刪除**
**roomIdSn**|**待刪除**



## <div id="refresh-token">更新金鑰效期</div>

**由【刷新金鑰】取得【全新效期金鑰】**

* 使用說明

參照單筆地址查詢，完成步驟(1)-(3)。

4. 回到 **```[會員專區]-[會員資料管理]```**，複製右方API金鑰內容的刷新金鑰。

![image](/src/main/resources/static/img/16.png)


5. 於輸入框輸入【刷新金鑰】後，按下下方 **```[Execute]```**

![image](/src/main/resources/static/img/17.png)

6. 執行完畢後下拉，會看見 **```[sever response]```** 之小標，下方黑框內容即為本次查詢結果。

![image](/src/main/resources/static/img/18.png)


8. 特別注意若回覆內容為**```[刷新金鑰已過期，請重新整理]```**，

需回到```[會員專區]-[會員資料管理]```頁面，進行重新整理。

<span style="color:red;background-color: lightgray; padding: 1px;">**全新效期的金鑰與刷新金鑰，將會更新在右邊API金鑰相關內容。**</span>

![image](/src/main/resources/static/img/19.png)

* 請求參數說明

|英文|中文
| ------- | ----------------------
**refreshToken**|**刷新金鑰**

* 響應內容說明

|英文|中文
| ------- | ----------------------
**eyJhbG....KLR8rqA**|**全新效期金鑰**

注意事項
---
OpenAPI若回覆403響應碼，
表示使用者身分驗證失敗，需使用上述刷新金鑰的API取得新效期金鑰。

![image](/src/main/resources/static/img/20.png)



